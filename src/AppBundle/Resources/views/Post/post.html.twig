{% extends "@App/base.html.twig" %}

{% block title %}{{ post.name }}{% endblock %}

{% block stylesheets %}
    {{ parent() }}
{% endblock %}

{% block content %}
    <div class="modal fade" id="confirm-delete" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                    <h4 class="modal-title" id="myModalLabel">Confirmation de la suppression</h4>
                </div>
                
                <div class="modal-body">
                    <p>Vous allez supprimez l'article, cette action sera irréversible.</p>
                    <p>Voulez-vous continuer ?</p>
                </div>
                
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal">Annuler</button>
                    <a class="btn btn-danger btn-ok">Supprimer</a>
                </div>
            </div>
        </div>
    </div>
    
    <div class="container">
        <div class="row">
            <div class="col-md-12">
                <div class="page-header">
                    <div class="btn-tollbar pull-right">
                        {% if hasRight %}
                        <div class="nav navbar-nav navbar-right">
                            <a href="{{ path("edit_post", {"slug": post.slug }) }}" class="btn btn-primary">Modifier</a>
                            <a href="#" data-href="{{ path("delete_post", {"id" : post.id}) }}" class="btn btn-danger" data-toggle="modal" data-target="#confirm-delete">Supprimer</a>
                        </div>
                        {% endif %}
                    </div>
                    <h1>{{ post.name }}</h1>
                </div>
                <p>
                    <small>
                        Catégorie : <a href="{{ path('lists_posts_category', {'categorySlug' : post.category.slug}) }}">{{ post.category }}</a>,
                        par <a href="{{ path("list_posts_author", {"idAuthor": post.author.id }) }}">{{ post.author.username }}</a> le {{ post.creationDate|date('c') }}
                    </small>
                </p>
                {{ post.content|purify }}
                
                <h3>Commentaire{% if post.comments|length > 1 %}s{% endif %} - {{ post.comments|length }} </h3>
                
                {{ form(comment_form) }}
                <div id="comments">
                    {% for comment in post.comments %}
                        <div class="row">
                            <div class="col-md-2">
                                <img src="{{ asset("bundles/app/img/gravatar.png") }}" width="100%">
                            </div>
                            <div class="col-md-10">
                                
                                <p><strong>{{ comment.username }}</strong>
                                    <time class="timeago" datetime="{{ comment.creationDate|date('c') }}"></time>
                                
                                <p>{{ comment.content }}</p>
                            </div>
                        </div>
                    {% endfor %}
                </div>
            </div>
        </div>
    </div>
{% endblock %}

{% block javascripts %}
    {{ parent() }}
    <script src= {{ asset('bundles/app/js/jquery.timeago.js') }}></script>
    <script src="{{ asset('bundles/app/js/format_date_ago.js') }}"></script>
    <script>
        $('#confirm-delete').on('show.bs.modal', function(e) {
            $(this).find('.btn-ok').attr('href', $(e.relatedTarget).data('href'));

            $('.debug-url').html('Delete URL: <strong>' + $(this).find('.btn-ok').attr('href') + '</strong>');
        });
    </script>
{% endblock %}